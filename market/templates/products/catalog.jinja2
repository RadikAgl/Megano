{% extends 'base.jinja2' %}

{% block title %}
    Каталог
{% endblock %}

{% block content %}
    <div class="Middle Middle_top">
        <div class="Section Section_column Section_columnLeft">
            <div class="wrap">
                <div class="Section-column">
                    <div class="Section-columnSection">
                        <header class="Section-header">
                            <strong class="Section-title">Фильтр
                            </strong>
                        </header>
                        <div class="Section-columnContent">
                          <form class="form" action="{{ url('products:catalog') }}" method="get">
                                <div class="form-group">
                                    {% with cheapest=view.object_list|min(attribute='price'),
                                    most_expensive=view.object_list|max(attribute='price') %}
                                    <div class="range Section-columnRange">
                                        <input class="range-line" id="price_range" name="price_range" type="text" data-type="double"
                                               data-min="10"
                                               data-max="5000"
                                               data-from="10"
                                               data-to="5000"/>
                                        <div class="range-price">Цена:&#32;
                                            <div class="rangePrice">
                                            </div>
                                        </div>
                                    </div>
                                    {% endwith %}
                                </div>
                                <div class="form-group">
                                    <input class="form-input form-input_full" id="name" name="name" type="text" placeholder="{{ _('Название') }}" />
                                </div>
                                <div class="form-group">
                                    <!-- - var options = setOptions(items, ['value', 'selected', 'disabled']);-->
                                </div>
                                <div class="form-group">
                                    <label class="toggle">
                                        <input type="checkbox" id="is_exist" name="is_exist"/><span class="toggle-box"></span><span
                                            class="toggle-text">Только товары в наличии</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="toggle">
                                        <input type="checkbox" id="free_delivery" name="free_delivery"/><span class="toggle-box"></span><span
                                            class="toggle-text">С бесплатной доставкой</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <div class="buttons"><input type="submit" class="btn btn_square btn_dark btn_narrow" value="Фильтр">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="Section-columnSection">
                        <header class="Section-header">
                            <strong class="Section-title">Популярные тэги
                            </strong>
                        </header>
                        <div class="Section-columnContent">
                            <div class="buttons">
                                {% for tag in tags %}
                                    <a class="btn btn_default btn_sm" href="?tag={{ tag.name }}">{{tag.name}}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="Section-content">
                    <div class="Sort">
                        <div class="Sort-title">Сортировать по:
                        </div>
                        <div class="Sort-variants">
                            {% with order_by=request.GET.get('o') %}
                                {% for parameter, name in ordering_fields %}
                                    {% if not order_by or parameter != order_by and parameter != order_by[1:] %}
                                        <a class="Sort-sortBy"
                                           href="?o={{ parameter }}">{{ name }}
                                        </a>
                                    {% else %}
                                        {% set order = '' if order_by.startswith('-') else '-' %}
                                        <a class="Sort-sortBy {% if order=='-' %}Sort-sortBy_dec{% else %}Sort-sortBy_inc{% endif %}"
                                           href="?o={{ order }}{{ parameter }}">{{ name }}
                                        </a>
                                    {% endif %}
                                {% endfor %}
                            {% endwith %}
                        </div>
                      </div>
                      <div class="Cards">
                          {% for offer in filter.qs %}
                              <div class="Card">
                                  <a class="Card-picture" href="{{ url('products:product-details', offer.product.id) }}">
                                  <img src="{{ offer.product.images.first().image.url }}" alt="card.jpg"/></a>
                                  <div class="Card-content">
                                      <strong class="Card-title">
                                          <a href="{{ url('products:product-details', offer.product.id) }}">
                                              {{ offer.product.name }}</a>
                                      </strong>
                                      <div class="Card-description">
                                          <div class="Card-cost"><span class="Card-price">${{ offer.price }}</span>
                                          </div>
                                          <div class="Card-category">
                                              {% with parent = offer.product.category.parent %}
                                                  {% if parent %}{{ parent }} / {% endif %}{{ offer.product.category }}
                                              {% endwith %}
                                          </div>
                                          <div class="Card-hover">
                                              <form method="post" action="{{ url('cart:cart-add',
                                              offer.product.id) }}">
                                                  {% csrf_token %}
                                                  <input class="Card-btn" type="image"
                                                         src="{{ static('img/icons/card/cart.svg') }}" alt="cart.svg">
                                              </form>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          {% endfor %}
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
