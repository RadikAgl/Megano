# Интернет-магазин MEGANO

Владелец торгового центра во время COVID-карантина решил перевести своих арендодателей в онлайн. Сделать это он намерен
с помощью создания платформы, на которой продавцы смогут разместить информацию о себе и своём товаре. Онлайновый
торговый центр или, другими словами, интернет-магазин, являющийся агрегатором товаров различных продавцов.

## log:pass

* admin@gmail.com:123456
* user2@gmail.com:123456
* user3@gmail.com:123456
* user4@gmail.com:123456
* user5@gmail.com:123456
* user6@gmail.com:123456
* user7@gmail.com:123456
* user8@gmail.com:123456
* user9@gmail.com:123456
* user10@gmail.com:123456

## Как установить

Для работы сервиса требуются:

- Python версии не ниже 3.10.
- установленное ПО для контейнеризации - [Docker](https://docs.docker.com/engine/install/).
- Инструмент [poetry](https://python-poetry.org/) для управления зависимостями и сборкой пакетов в Python.

Настройка переменных окружения

1. Скопируйте файл .env.dist в .env
2. Заполните .env файл. Пример:

```yaml
DATABASE_URL = postgresql://skillbox:secret@127.0.0.1:5439/market
REDIS_URL = redis://127.0.0.1:6379/0
```

### Запуск СУБД Postgresql

   ```shell
   docker run --name skillbox-db-39 -e POSTGRES_USER=skillbox -e POSTGRES_PASSWORD=secret -e POSTGRES_DB=market -p 5439:5432 -d postgres
   ```

### Запуск брокера сообщений REDIS

   ```shell
   docker run --name redis-db -d -p 6379:6379 redis
   ```

### Установка и активация виртуального окружения

   ```shell
   poetry install  ; установка пакетов
   poetry shell  ; активация виртуального окружения
   pre-commit install  ; установка pre-commit для проверки форматирования кода, см. .pre-commit-config.yaml
   ```

## Как удалить контейнеры

### СУБД Postgres

   ```shell
   docker rm -f -v skillbox-db-39
   ```

### Брокер сообщений REDIS

   ```shell
   docker rm -f -v redis-db
   ```

## Проверка форматирования кода

Проверка кода выполняется из корневой папки репозитория.

* Анализатор кода flake8
   ```shell
   flake8 market
   ```
* Линтер pylint
   ```shell
   pylint --fail-under=7 --rcfile=.pylintrc market/*
   ```
* Линтер black
   ```shell
   black market
   ```

## Как запустить web-сервер

Запуск сервера производится в активированном локальном окружение из папки `market/`

   ```shell
   python manage.py runserver 0.0.0.0:8000
   ```

## Загрузка фикстур Django

Этот скрипт предназначен для загрузки всех фикстур Django из каталога 'fixtures' в db проекта.

### Использование

- Запустите скрипт, используя интерпретатор Python:

    ```bash
    python load_fixtures.py
    ```

Скрипт автоматически обнаружит и загрузит все файлы JSON в указанном каталоге 'fixtures'. Если порядок загрузки важен,
файлы будут обработаны в отсортированном порядке.

# Запуск Celery

Celery используется для асинхронной обработки задач. Убедитесь, что виртуальный окружение активировано, и сервер
запущен, затем откройте новое окно терминала и выполните следующие команды:

**Запуск Celery Worker:**

   ```bash
   celery -A config worker --loglevel=INFO -P eventlet

   ```

**Запуск Celery Beat откройте новое окно терминала:**

   ```bash
   celery -A config beat -l info
   ```

Это запустит Celery Worker и Celery Beat, обеспечивая асинхронную обработку задач в фоновом режиме.

## Дополнительные замечания

Убедитесь, что у вас установлен и запущен брокер сообщений Redis, так как Celery требует его для управления очередью
задач.

## Импорт данных

Приложение предоставляет возможность импорта данных из файлов CSV. Для успешного импорта необходимо следовать
определенной структуре данных в CSV-файле.

### Структура CSV-файла

CSV-файл должен содержать следующие колонки:

1. **Название товара**: Наименование продукта.
2. **Основная категория**: Название основной категории, к которой принадлежит продукт.
3. **Подкатегория**: Название подкатегории, если она присутствует.
4. **Описание**: Описание продукта.
5. **Детали**: Дополнительные детали продукта в формате "ключ: значение".
6. **Теги**: Список тегов, разделенных запятыми.
7. **Цена**: Цена продукта.
8. **Остаток**: Количество оставшихся продуктов.

Пример структуры CSV-файла:

```csv
Название товара,Основная категория,Подкатегория,Описание,Детали,Теги,Цена,Остаток
Пример товара 1,Электроника,Смартфоны,Мощный смартфон,Размер экрана: 6",RAM: 4GB,Android,500,20
Пример товара 2,Одежда,Обувь,Удобные кроссовки,Цвет: черный,Размер: 42,Спорт,120,50
```

## Пример файла CSV

Вы можете воспользоваться [этим примером файла CSV](market/docs/Sheet1.csv) для тестирования импорта. Скачайте файл и
используйте его для импорта данных в приложение.

### Инструкции по импорту

1. Войдите в систему и перейдите на страницу импорта.
2. Выберите файл CSV для импорта.
3. Нажмите кнопку "Начать импорт".
4. После завершения импорта вы увидите результаты операции.

Обратите внимание, что успешный импорт зависит от корректной структуры файла и данных в нем. Пожалуйста, удостоверьтесь,
что ваш файл CSV соответствует указанным требованиям.

## Запуск оболочки django-extensions

   ```bash
   python manage.py shell_plus  --print-sql
   ```

## Инструкция по международной локализации в проекте

Этот проект использует Django для создания веб-приложения. Международная локализация (i18n) позволяет адаптировать
приложение для использования на разных языках и в разных регионах. Ниже приведены шаги по настройке и использованию
международной локализации в проекте.

* ### Настройка проекта

1. **Настройка файлов `settings.py`**:
    - Установите язык по умолчанию в `LANGUAGE_CODE`.
    - Определите доступные языки в `LANGUAGES`.
    - Укажите `LOCALE_PATHS`, где будут храниться переводы.
    - Установите `USE_I18N`, `USE_TZ` и `USE_L10N` в `True`.
    - Используйте `django.middleware.locale.LocaleMiddleware` в `MIDDLEWARE`.

2. **Шаблоны Jinja2**:
    - Используйте `django-jinja` для шаблонов Jinja2.
    - Укажите директории с шаблонами в `DIRS`.
    - Установите соответствующие `OPTIONS`, включая `context_processors`.

3. **Создание переводов**:
    - Создайте директорию `locale` в корне проекта.
    - Используйте команду `python manage.py makemessages -l <язык>` для создания файлов перевода.

4. **Поддержка переводов в шаблонах**:
    - Используйте `{% trans %}` теги для маркировки текста, подлежащего переводу.
    - Используйте функцию `gettext_lazy` для перевода строк Python.

5. **В файле `settings.py` функция**:

   ```python
   class DjangoTranslationExtension(Extension):
       def __init__(self, environment):
           super(DjangoTranslationExtension, self).__init__(environment)
           environment.globals["_"] = gettext
   ```
   добавляет псевдоним "_" для функции gettext, что позволяет использовать переводы в шаблонах Jinja2 и файлах Python.
* ### Процесс локализации

1. **Создание файлов перевода**:
    - Используйте команду `makemessages` для создания шаблонов перевода.
    - Редактируйте файлы `.po` в директории `locale` для каждого языка.

2. **Компиляция переводов**:
    - Используйте команду `compilemessages` для компиляции файлов перевода в формат `.mo`.

3. **Использование переводов**:
    - Загрузите переводы при запуске проекта.
    - Используйте `{% trans %}` теги и функцию `gettext_lazy` или `_("Text")` в шаблонах и Python-коде.

4. **Тестирование**:
    - Проверьте работоспособность переводов для всех языков, поддерживаемых проектом.

* ### Команда для "умной" локализации

1. [x] Для удобства можно использовать следующую "хитрую" команду для создания файлов перевода для шаблонов Jinja2 и
   Python-кода:

    ```bash
    python manage.py makemessages -l en --extension jinja2 --extension py
    ```

Эта команда создаст файлы перевода для языка en (английский) для всех шаблонов Jinja2 и файлов Python.

### Использование переводов в шаблонах

1. [x] Для использования переводов в шаблонах Jinja2 вы можете использовать следующие методы:

1. **С помощью тега {% trans %}**:

   ```jinja
   {% trans %}текст{% endtrans %}
   ```
2. **С использованием функции {{ _("text") }}**:

   ```jinja
   {{ _("текст") }}
   ```

Это руководство поможет вам эффективно использовать международную локализацию в вашем проекте Django. При следовании
этим шагам ваше приложение будет готово к использованию на разных языках и в разных культурных средах.

# Цели проекта

Код написан в учебных целях — это курс по Джанго на
сайте [Skillbox](https://go.skillbox.ru/education/course/django-framework).
